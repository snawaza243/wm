CREATE OR REPLACE PROCEDURE PSM_PRINT_REN_SAVE_LOGOUT(
    PX_FORM_PATH IN VARCHAR2,
    PX_FORM_NAME IN VARCHAR2,
    PX_GLB_SAVE_LOGIN_TIME IN VARCHAR2,
    PX_LOGE IN VARCHAR2,
    PX_ROLE IN VARCHAR2,
    PX_CURSOR OUT SYS_REFCURSOR
) AS 

    V_MAIN_PATH VARCHAR2(1000);
    V_L_PATH VARCHAR2(1000);

BEGIN
    SAVEPOINT START_TRANSACTION;

    SELECT MAIN INTO V_MAIN_PATH FROM BACKOFFICE_FORMS WHERE MAIN= PX_FORM_NAME;   
    
    IF V_MAIN_PATH IS NOT NULL THEN
        V_L_PATH:=V_MAIN_PATH;
    END IF;

    UPDATE APPLICATION_LOG
    SET ENDDATE = TO_DATE(SYSDATE, 'DD/MM/YYYY'),
        ENDTIME = TO_CHAR(SYSDATE, 'HH24:MI:SS')
    WHERE USER_ID = PX_LOGE
      AND FORM_REPORT = SUBSTR(V_L_PATH, -100)
      AND INTIME = PX_ROLE;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK TO START_TRANSACTION;
        RAISE_APPLICATION_ERROR(-20001, 'Error in PSM_PRINT_REN_SAVE_LOGOUT: ' || SQLERRM);
END PSM_PRINT_REN_SAVE_LOGOUT;
/