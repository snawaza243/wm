Dim rs_get_trantype As New ADODB.Recordset
Dim RsData As New ADODB.Recordset
Dim rslead As New ADODB.Recordset
Dim ARCODE As ADODB.Recordset
Dim MyRmName As String
Dim MyBusiCode As String
Dim strmsg As String
Dim MyBranch As String
Dim ARCODE1 As ADODB.Recordset
Dim rsMap As New ADODB.Recordset
Dim rsMap1 As New ADODB.Recordset
Dim ArLead() As String
Dim rsAmc As New ADODB.Recordset
Dim rsscheme As New ADODB.Recordset
Dim MyAmcCode As String
Dim MySchCode As String
Dim MyTranCode As String
Dim rs_branch As ADODB.Recordset
Dim ColumnIndex As Long
Dim Glb_L_SearchIndex As Integer
Dim Glb_Selected_row As Integer
Dim Glb_Flag_First_Time As Boolean
Dim MyOrder As String
Dim KCount_cOL As Integer
Dim MyTotalAmount1 As Double
Dim MyTotalAmount2 As Double
Dim MyTotalTrans1 As Long
Dim MyTotalTrans2 As Long
Dim MyTotalMargin1 As Double
Dim MyTotalmargin2 As Double
Dim MySelectedRow As Integer
Dim MyCurrRow As Integer
Dim MySelectedRow1 As Integer
Dim MyCurrRow1 As Integer
Dim ColumnIndex1 As Long
Dim Glb_L_SearchIndex1 As Integer
Dim Glb_Selected_row1 As Integer
Dim Glb_Flag_First_Time1 As Boolean
Dim MyOrder1 As String

Dim paymode As String
Dim cmbList As String
Dim DoGrid As Integer
Dim MyPayble As Currency
Dim strbranch() As String
Dim MyBranchCode As String
Dim MyRegionCode As String
Dim MyZoneCode As String
Dim MyRmCode As String
Dim MyMutCode As String
Dim MyMutCodeAr As String
Dim StrBranchAr() As String
Dim MyBranchCodeAr As String

Dim MyAppNo As String
Dim MyChqNo As String
Dim MyPan As String
Dim MyFolio As String
Dim MyAmount As Long
Dim MyInvestorName As String
Dim MyTrCode As String
Dim MyTempTrCode As String
Dim MyTrDate As Date
Dim MyRtaTrCode As String
Dim MyRtaTrDate As String
Dim MyDispatch As String
Private Sub gridfill(X As Integer)
On Error GoTo err1
If X = 1 Then
    StrSql = " SELECT   FOLIO_NO, SCH_CODE, TR_DATE, TRAN_TYPE, "
    StrSql = StrSql & "         MAX (inv_name) Inv_Name, MAX (ADDRESS) ADDRESS, "
    StrSql = StrSql & "         MAX (BROKER_CODE) BROKER_CODE, MAX (CITY_NAME) CITY_NAME, max(sch_name)SCH_NAME, "
    StrSql = StrSql & "         MAX(MUT_CODE)MUT_CODE, MAX(MUT_NAME)MUT_NAME, MAX(RM_NAME)RM_NAME, MAX(BRANCH_NAME)BRANCH_NAME, MAX (APP_NO) APP_NO, "
    StrSql = StrSql & "         MAX (CHEQUE_NO) CHEQUE_NO, SUM (AMOUNT) AMOUNT, "
    StrSql = StrSql & "         MAX (BUSI_BRANCH_CODE) BUSI_BRANCH_CODE, "
    StrSql = StrSql & "         MAX (BUSINESS_RMCODE) BUSINESS_RMCODE,GETTRANCODE(FOLIO_NO,SCH_CODE,TR_DATE,TRAN_TYPE)UNIQUE_TRAN "
    StrSql = StrSql & "   FROM ( "
    StrSql = StrSql & " SELECT  tran_type,t.inv_name,(i.ADDRESS1||','||i.ADDRESS2||','||i.EMAIL) address, "
    StrSql = StrSql & "         REG_SUBBROK broker_code,c.city_name, "
    StrSql = StrSql & "         t.sch_code,sch_name sch_name,t.mut_code,amc.mut_name mut_name, rm_name,  "
    StrSql = StrSql & "         branch_name,  "
    StrSql = StrSql & "         app_no,folio_no, cheque_no, "
    StrSql = StrSql & "         amount,  t.tran_code,reg_date as tr_date, "
    StrSql = StrSql & "         busi_branch_code, business_rmcode "
    StrSql = StrSql & "    FROM employee_master e, "
    StrSql = StrSql & "         branch_master b, "
    StrSql = StrSql & "         mut_fund amc, "
    StrSql = StrSql & "         scheme_info sch, "
    StrSql = StrSql & "         TRANSACTION_ST@MF.BAJAJCAPITAL t, "
    StrSql = StrSql & "         investor_master i,CITY_MASTER C "
    StrSql = StrSql & "   WHERE I.CITY_ID=C.CITY_ID(+)"
    StrSql = StrSql & "     AND t.client_code = i.inv_code "
    StrSql = StrSql & "     AND to_char(t.rmcode) = e.rm_code "
    StrSql = StrSql & "     AND t.BRANCH_CODE = b.branch_code   "
    StrSql = StrSql & "     AND t.mut_code = amc.mut_code AND t.sch_code = sch.sch_code AND (DUP_FLAG2 = 0 OR (REG_TRAN_TYPE='TICOB' AND DUP_FLAG2 IN(0,9))) "
    If SRmCode <> "" Then
         StrSql = StrSql & " and e.rm_code=" & SRmCode & ""
    End If
    
    If MyTranCode <> "" Then
       StrSql = StrSql & " and t.tran_code IN(" & MyTempTrCode & ")"
    End If
    
    'StrSql = StrSql & "  AND LPAD (t.mut_code, 2) = 'MF' "
    
    StrSql = StrSql & "     AND (t.asa <> 'C' OR t.asa IS NULL) "
    StrSql = StrSql & "                                    AND t.tran_type IN "
    StrSql = StrSql & "                                           ('PURCHASE', 'REINVESTMENT', "
    StrSql = StrSql & "                                            'SWITCH IN') "
    StrSql = StrSql & "ORDER BY "
    If MyOrder = "" Then
        StrSql = StrSql & "  TR_Date,rm_name "
    End If
    StrSql = StrSql & " ) "
    StrSql = StrSql & "GROUP BY FOLIO_NO, "
    StrSql = StrSql & "         SCH_CODE, "
    StrSql = StrSql & "         TR_DATE, "
    StrSql = StrSql & "         TRAN_TYPE "
    Set rsMap = New ADODB.Recordset
    rsMap.open StrSql, MyConn, adOpenForwardOnly, adLockOptimistic
Else
    StrSql = " select inv.Investor_Name,inv.address1||','||inv.address2||','||inv.phone||','||inv.email address ,ct.city_name "
    StrSql = StrSql & " ,mf.bank_name,mf.client_code,mf.sch_code sch_code,mf.mut_code,rm_name,branch_name,panno,amc.mut_name mut_Name,Sch_Name Sch_Name,tr_date,TRAN_TYPE,App_No,folio_no,payment_mode, cheque_no, CHEQUE_DATE,"
    StrSql = StrSql & "Amount,Sip_Type,lEAD_nO,LEAD_NAME,TRAN_code,b.branch_code,BUSINESS_RMCODE"
    StrSql = StrSql & " from city_master ct,employee_master e,investor_master inv,branch_master b,ALLCOMPANY amc,ALLSCHEME sch,TRANSACTION_MF_TEMP1 mf "
    StrSql = StrSql & " where  MF.MOVE_FLAG1 IS NULL AND MF.SIP_ID IS  NULL AND inv.city_id=ct.city_id and mf.client_code=inv.inv_code and  to_char(mf.BUSINESS_RMCODE)=to_char(e.payroll_id) and mf.BUSI_BRANCH_CODE=b.branch_code  "
    If cmbbranch.Text <> "" And cmbbranch.Text <> "ALL" And MyBranchCode <> "" Then
        StrSql = StrSql & " and mf.mut_code=amc.mut_code and mf.sch_code=sch.sch_code and b.branch_code in (" & MyBranchCode & ")"
    Else
        StrSql = StrSql & " and mf.mut_code=amc.mut_code and mf.sch_code=sch.sch_code and b.branch_code in (" & Branches & ")"
    End If
    If CmbRegion.Text <> "" And UCase(CmbRegion.Text) <> "ALL" And MyRegionCode <> "" Then
        StrSql = StrSql & " and b.region_id ='" & MyRegionCode & "'"
    End If
    If TxtAR.Text <> "" Then
        StrSql = StrSql & " and MF.TRAN_CODE ='" & TxtAR.Text & "'"
    End If
    If CmbZone.Text <> "" And UCase(CmbZone.Text) <> "ALL" And MyZoneCode <> "" Then
        StrSql = StrSql & " and b.zone_id ='" & MyZoneCode & "'"
    End If
    If CmbRM.Text <> "" And UCase(CmbRM.Text) <> "ALL" And MyRmCode <> "" Then
        StrSql = StrSql & " and e.payroll_id ='" & MyRmCode & "'"
    End If
    If SRmCode <> "" Then
         StrSql = StrSql & " and e.rm_code=" & SRmCode & ""
    End If
    If CmbAmcTR.Text <> "" And UCase(CmbAmcTR.Text) <> "ALL" Then
        StrSql = StrSql & " and mf.mut_code ='" & MyMutCode & "'"
    End If
    If OptManulaRecon.Value = True Then
        StrSql = StrSql & " and mf.rec_flag='Y' and mf.rec_user<>'Auto'"
    ElseIf OptAutoRecon.Value = True Then
        StrSql = StrSql & " and mf.rec_user='Auto' and mf.rec_flag='Y' "
    End If
    
    StrSql = StrSql & " and mf.audit_flag is null "
    
    If mskfromdt.Text <> "__/__/____" Then
        StrSql = StrSql & " and to_date(reco_date)>=TO_DATE('" & mskfromdt1 & "','DD/MM/YYYY') "
    End If
    If msktodt.Text <> "__/__/____" Then
        StrSql = StrSql & " and to_date(reco_date)<=TO_DATE('" & msktodt1 & "','DD/MM/YYYY') "
    End If
    StrSql = StrSql & " order by "
    If MyOrder1 = "" Then
        StrSql = StrSql & "  TR_Date,rm_name "
    Else
        StrSql = StrSql & "" & MyOrder1
    End If
    If Option1(3).Value = True Then
        StrSql = StrSql & " Desc"
    End If
    Set rsMap1 = New ADODB.Recordset
    rsMap1.open StrSql, MyConn, adOpenForwardOnly, adLockOptimistic
End If
i = 1
j = 1
If X = 1 Then
    VSFCommGrdK.Clear
ElseIf X = 2 Then
    VSFCommGrdT.Clear
    VSFCommGrdK.Clear
End If
Call SetGrid
If X = 1 Then
    VSFCommGrdK.Rows = rsMap.RecordCount + 1
    If rsMap.EOF Then
        MsgBox "No record found corresponding to the searching criteria", vbInformation
        Exit Sub
    End If
    While Not rsMap.EOF
        VSFCommGrdK.TextMatrix(i, 0) = rsMap("UNIQUE_TRAN")
        VSFCommGrdK.TextMatrix(i, 1) = rsMap("tr_date")
        VSFCommGrdK.TextMatrix(i, 2) = IIf(IsNull(rsMap("Inv_Name")), "", rsMap("inv_name"))
        VSFCommGrdK.TextMatrix(i, 3) = IIf(IsNull(rsMap("Address")), "", rsMap("address"))
        VSFCommGrdK.TextMatrix(i, 4) = IIf(IsNull(rsMap("City_Name")), "", rsMap("City_Name"))
        VSFCommGrdK.TextMatrix(i, 5) = IIf(IsNull(rsMap("Mut_Name")), "", rsMap("Mut_Name"))
        VSFCommGrdK.TextMatrix(i, 6) = IIf(IsNull(rsMap("Sch_Name")), "", rsMap("Sch_Name"))
        VSFCommGrdK.TextMatrix(i, 7) = rsMap("Amount")
        VSFCommGrdK.TextMatrix(i, 8) = IIf(IsNull(rsMap("Folio_no")), "", rsMap("folio_no"))
        VSFCommGrdK.TextMatrix(i, 9) = IIf(IsNull(rsMap("cheque_no")), 0, rsMap("cheque_no"))
        VSFCommGrdK.TextMatrix(i, 10) = IIf(IsNull(rsMap("app_no")), 0, rsMap("app_no"))
        VSFCommGrdK.TextMatrix(i, 11) = IIf(IsNull(rsMap("Rm_Name")), "", rsMap("Rm_Name"))
        VSFCommGrdK.TextMatrix(i, 12) = IIf(IsNull(rsMap("Branch_Name")), "", rsMap("Branch_Name"))
        VSFCommGrdK.TextMatrix(i, 13) = IIf(IsNull(rsMap("broker_Code")), "", rsMap("Broker_Code"))
        VSFCommGrdK.TextMatrix(i, 14) = IIf(IsNull(rsMap("mut_code")), 0, rsMap("mut_code"))
        VSFCommGrdK.TextMatrix(i, 15) = IIf(IsNull(rsMap("sch_code")), 0, rsMap("sch_code"))
        i = i + 1
        rsMap.MoveNext
     Wend
     rsMap.Close
     Set rsMap = Nothing
Else
     VSFCommGrdT.Rows = rsMap1.RecordCount + 1
     LblCount = rsMap1.RecordCount
     While Not rsMap1.EOF
        VSFCommGrdT.TextMatrix(j, 0) = rsMap1("TRAN_code")
        VSFCommGrdT.TextMatrix(j, 1) = rsMap1("tr_date")
        VSFCommGrdT.TextMatrix(j, 2) = IIf(IsNull(rsMap1("Investor_Name")), "", rsMap1("Investor_Name"))
        VSFCommGrdT.TextMatrix(j, 3) = IIf(IsNull(rsMap1("Address")), "", rsMap1("address"))
        VSFCommGrdT.TextMatrix(j, 4) = IIf(IsNull(rsMap1("City_Name")), "", rsMap1("City_Name"))
        VSFCommGrdT.TextMatrix(j, 5) = IIf(IsNull(rsMap1("Mut_Name")), "", rsMap1("Mut_Name"))
        VSFCommGrdT.TextMatrix(j, 6) = IIf(IsNull(rsMap1("Sch_Name")), "", rsMap1("Sch_Name"))
        VSFCommGrdT.TextMatrix(j, 7) = rsMap1("Amount")
        VSFCommGrdT.TextMatrix(j, 8) = IIf(IsNull(rsMap1("Folio_no")), "", rsMap1("folio_no"))
        VSFCommGrdT.TextMatrix(j, 9) = IIf(IsNull(rsMap1("cheque_no")), 0, rsMap1("cheque_no"))
        VSFCommGrdT.TextMatrix(j, 10) = IIf(IsNull(rsMap1("app_no")), 0, rsMap1("app_no"))
        VSFCommGrdT.TextMatrix(j, 11) = IIf(IsNull(rsMap1("Rm_Name")), "", rsMap1("Rm_Name"))
        VSFCommGrdT.TextMatrix(j, 12) = IIf(IsNull(rsMap1("Branch_Name")), "", rsMap1("Branch_Name"))
        VSFCommGrdT.TextMatrix(j, 13) = IIf(IsNull(rsMap1("mut_code")), 0, rsMap1("mut_code"))
        VSFCommGrdT.TextMatrix(j, 14) = IIf(IsNull(rsMap1("sch_code")), 0, rsMap1("sch_code"))
        
'        'FOR MISSING FLAG
'        VSFCommGrdT.Row = i
'        VSFCommGrdT.Col = 18
'        VSFCommGrdT.CellForeColor = vbWhite
'        Set VSFCommGrdT.CellPicture = Image2.Picture
'        If rsMap1.Fields("missing") <> "" Then
'            Set VSFCommGrdT.CellPicture = Image1.Picture
'            VSFCommGrdT.CellPictureAlignment = 4
'            VSFCommGrdT.Text = 1
'        Else
'            Set VSFCommGrdT.CellPicture = Image2.Picture
'            VSFCommGrdT.CellPictureAlignment = 4
'            VSFCommGrdT.Text = 0
'        End If
'        VSFCommGrdT.CellPictureAlignment = 4
'        '-----------------------------------FOR SOLUTION FLAG-----------------------------
'        VSFCommGrdT.Row = i
'        VSFCommGrdT.Col = 19
'        VSFCommGrdT.CellForeColor = vbWhite
'        Set VSFCommGrdT.CellPicture = Image2.Picture
'        If rsMap1.Fields("SOLVE") <> "" Then
'            VSFCommGrdT.Text = 1
'            Set VSFCommGrdT.CellPicture = Image1.Picture
'            VSFCommGrdT.CellPictureAlignment = 4
'        Else
'            VSFCommGrdT.Text = 0
'            Set VSFCommGrdT.CellPicture = Image2.Picture
'            VSFCommGrdT.CellPictureAlignment = 4
'        End If
'        VSFCommGrdT.CellPictureAlignment = 4
'        '--------------------------------------------------------------------------------
'        VSFCommGrdT.TextMatrix(i, 20) = IIf(IsNull(rsMap1("SOL_REF_AR")), "", rsMap1("SOL_REF_AR"))
'        On Error Resume Next
'        VSFCommGrdT.TextMatrix(i, 21) = rsMap1("SOL_DATE")
'        MyTotalAmount2 = MyTotalAmount2 + rsMap1("Amount")
'        MyTotalmargin2 = MyTotalmargin2 + Val(VSFCommGrdT.TextMatrix(i, 17))
'        MyTotalTrans2 = MyTotalTrans2 + i
        j = j + 1
        rsMap1.MoveNext
     Wend
   
'     LblAmount2.Caption = Round(MyTotalAmount2, 0)
'     LblMargin2.Caption = Round(MyTotalmargin2, 0)
'     LblTrans2.Caption = Round(MyTotalTrans2, 0)
     rsMap1.Close
     Set rsMap1 = Nothing
End If
DoEvents
Exit Sub
err1:
    MsgBox err.Description
    Resume
End Sub
Public Sub SelectText(obj As Object)
    obj.SelStart = 0
    obj.SelLength = Len(obj.Text)
Exit Sub
Errhandler:
    MsgBox err.Description, vbCritical
End Sub

Private Sub Clear_Previously_Selected()
    On Error GoTo Bot
    Dim KCount_cOL As Integer
    If Glb_Flag_First_Time = False Then
        Exit Sub
    End If
    If Glb_Selected_row <> 0 Then
         VSFCommGrdT.Row = Glb_Selected_row
         For KCount_cOL = 1 To VSFCommGrdT.Cols - 1
            VSFCommGrdT.Col = KCount_cOL
            VSFCommGrdT.CellBackColor = vbWhite
            VSFCommGrdT.FontBold = True
            VSFCommGrdT.CellForeColor = vbBlack
            VSFCommGrdT.CellFontBold = False
        Next
    End If
    Exit Sub
Bot:
    'Call ShowErrorMessage(err.Description)
End Sub
Private Sub Clear_Previously_Selected1()
    On Error GoTo Bot
    Dim KCount_cOL As Integer
    If Glb_Flag_First_Time1 = False Then
        Exit Sub
    End If
    If Glb_Selected_row1 <> 0 Then
         VSFCommGrdT.Row1 = Glb_Selected_row1
         For KCount_Col1 = 1 To VSFCommGrdT.Cols - 1
            VSFCommGrdT.Col = KCount_Col1
            VSFCommGrdT.CellBackColor = vbWhite
            VSFCommGrdT.FontBold = True
            VSFCommGrdT.CellForeColor = vbBlack
            VSFCommGrdT.CellFontBold = False
        Next
    End If
    Exit Sub
Bot:
    'Call ShowErrorMessage(err.Description)
End Sub

Private Sub cmdArPrint_Click()
If lbtrancode.Caption = "" Then
    MsgBox "Ar Can Not Be Print Right Now"
    Exit Sub
End If
'Sql = " create or replace view transaction_mfview as "
'Sql = Sql & " SELECT   mf.investor_name, mf.bank_name, mf.client_code, mf.sch_code, "
'Sql = Sql & "         rm_name, branch_name, panno, amc.mut_name amc_name, "
'Sql = Sql & "         sch_name scheme_name, tr_date, tran_type, app_no, payment_mode,  cheque_no, "
'Sql = Sql & "          CHEQUE_DATE, amount, sip_type, lead_no, lead_name, tran_code, branch_code, "
'Sql = Sql & "         BUSINESS_RMCODE "
'Sql = Sql & "    FROM wealthmaker.employee_master e, "
'Sql = Sql & "         wealthmaker.branch_master b, "
'Sql = Sql & "         wealthmaker.mut_fund amc, "
'Sql = Sql & "         wealthmaker.scheme_info sch, "
'Sql = Sql & "         wealthmaker.TRANSACTION_MF_TEMP1 mf "
'Sql = Sql & "   WHERE TO_CHAR (mf.BUSINESS_RMCODE) = TO_CHAR (e.payroll_id) "
'Sql = Sql & "     AND mf.BUSI_BRANCH_CODE = b.branch_code "
'Sql = Sql & "     AND mf.mut_code = amc.mut_code "
'Sql = Sql & "     AND mf.sch_code = sch.sch_code "
'Sql = Sql & "ORDER BY tr_date, rm_name "
'myconn.Execute Sql
CrystalReport1.Reset
CrystalReport1.Connect = MyConn
CrystalReport1.LogOnServer "pdsodbc.dll", "test", "wealthmaker", "wealthmaker", DataBasePassword
CrystalReport1.ReportFileName = App.Path & "\Reports\Ar1.rpt"
CrystalReport1.SelectionFormula = "{transaction_mfview.tran_code}='" & lbtrancode.Caption & "'"
CrystalReport1.WindowState = crptMaximized
CrystalReport1.WindowShowPrintSetupBtn = True
CrystalReport1.WindowShowSearchBtn = True
CrystalReport1.WindowShowPrintBtn = True
CrystalReport1.action = 1
End Sub




Private Sub CmbAmcTR_Change()
Call CmbAmcTR_Click
End Sub


Private Sub CmbAmcTR_Click()
CmbAmcAR.ListIndex = CmbAmcTR.ListIndex
End Sub


Private Sub cmbbranch_Change()
'comment by pankaj kumar pundir on dated 11032016
'Dim b_id() As String
'b_id = Split(cmbbranch.Text, "#")
'CmbRM.Clear
'Dim RsCompany As New ADODB.Recordset
'Dim Mysql As String
'Mysql = "select rm_name,payroll_id from employee_master where 1=1"
'If cmbbranch.Text <> "All" Then
'     Mysql = Mysql & " and source=" & b_id(1) & ""
'End If
'If SRmCode <> "" Then
'     Mysql = Mysql & " and rm_code=" & SRmCode & ""
'End If
'Mysql = Mysql & " and source in (" & Branches & ")"
'Mysql = Mysql & " and category_id in (2001,2018) order by rm_name"
'CmbRM.Clear
'RsCompany.open Mysql, MyConn
'Do While Not RsCompany.EOF
'     CmbRM.AddItem RsCompany("rm_name") & Space(90) & "#" & RsCompany("payroll_id")
'     RsCompany.MoveNext
'Loop
'RsCompany.Close
'Set RsCompany = Nothing
'If cmbbranchAr.ListIndex <> -1 Then
'    cmbbranchAr.ListIndex = cmbbranch.ListIndex
'End If
End Sub

Private Sub cmbbranch_Click()
'Call cmbbranch_Change 'comment by pankaj pundir on dated 11032016
If cmbbranchAr.ListIndex <> -1 Then
    cmbbranchAr.ListIndex = cmbbranch.ListIndex
End If
End Sub


Private Sub cmbbranch_LostFocus()
'add by pankaj pundir on dated 11032016
If cmbbranch.Text <> "All" Then
    Dim b_id() As String
    b_id = Split(cmbbranch.Text, "#")
    CmbRM.Clear
    Dim RsCompany As New ADODB.Recordset
    Dim Mysql As String
    Mysql = "select distinct rm_name,payroll_id from employee_master where 1=1"
    If cmbbranch.Text <> "All" Then
         Mysql = Mysql & " and source=" & b_id(1) & ""
    End If
    If SRmCode <> "" Then
         Mysql = Mysql & " and rm_code=" & SRmCode & ""
    End If
    Mysql = Mysql & " and source in (" & Branches & ")"
    Mysql = Mysql & " and category_id in (2001,2018) order by rm_name"
    CmbRM.Clear
    RsCompany.open Mysql, MyConn
    Do While Not RsCompany.EOF
         CmbRM.AddItem RsCompany("rm_name") & Space(90) & "#" & RsCompany("payroll_id")
         RsCompany.MoveNext
    Loop
    RsCompany.Close
    Set RsCompany = Nothing
Else
    CmbRM.Clear
End If
End Sub

Private Sub CmbFind1_Click()
 Dim kCount As Integer
    Dim KCount_cOL As Integer
    Dim Column_name As Integer
    Dim KCount_Row As Integer
    Glb_Flag_First_Time1 = True
    If Trim(TxtFind1.Text) = "" Then
        Glb_L_SearchIndex1 = 1
        Exit Sub
    End If
     Clear_Previously_Selected1
     For kCount = Glb_L_SearchIndex To VSFCommGrdT.Rows - 1
        If InStr(1, UCase(VSFCommGrdT.TextMatrix(kCount, ColumnIndex1)), UCase(TxtFind1.Text)) > 0 Then
            Glb_Comming_From_Search = True
            VSFCommGrdT.Row = kCount
            If kCount > 12 Then VSFCommGrdT.TopRow = kCount
            For KCount_cOL = 1 To VSFCommGrdT.Cols - 1
                Glb_Comming_From_Search = True
                VSFCommGrdT.Col = KCount_cOL
                VSFCommGrdT.CellBackColor = vbWhite
                VSFCommGrdT.FontBold = True
                VSFCommGrdT.CellForeColor = vbRed
                VSFCommGrdT.CellFontBold = True
            Next
            Glb_L_SearchIndex = kCount + 1
            Glb_Selected_row = kCount
            VSFCommGrdT.TopRow = kCount
            Exit Sub
       End If
    Next
    If kCount >= VSFCommGrdT.Rows - 1 Then
        MsgBox "No Such Record Found", vbInformation, "Search Completed"
        TxtFind1.Text = ""
        TxtFind1.SetFocus
        Glb_L_SearchIndex = 1
        Glb_Selected_row = 0
    End If
End Sub

Private Sub cmbRegion_Change()
Dim RS As New ADODB.Recordset, Mysql As String
MyRegionCode = ""
If CmbRegion.Text <> "" And UCase(CmbRegion.Text) <> "ALL" Then
    strbranch = Split(CmbRegion.Text, "#")
    MyRegionCode = strbranch(1)
End If
If CmbRegion.Text = "All" Then
    CmbZone.Clear
    cmbbranch.Clear
    Mysql = "select branch_name,branch_code from branch_master where 1=1"
    If GlbDataFilter <> "72" Then Mysql = Mysql & " and branch_code in (" & Branches & ")"
    Mysql = Mysql & " AND category_id not in ('1005','1006') order by branch_name"
    RS.open Mysql, MyConn
    Do While Not RS.EOF
        cmbbranch.AddItem RS(0) & Space(80) & "#" & RS(1)
        RS.MoveNext
    Loop
    RS.Close
    cmbbranch.AddItem "All", 0
    cmbbranch.ListIndex = 0
    Set RS = Nothing
    CmbZone.AddItem "All", 0
    CmbZone.ListIndex = 0
Else
    CmbZone.Clear
    Mysql = "select distinct zone_name,z.zone_id from branch_master b, zone_master z where b.zone_id=z.zone_id and b.region_id='" & MyRegionCode & "'"
    If GlbDataFilter <> "72" Then Mysql = Mysql & " and branch_code in (" & Branches & ")"
    Mysql = Mysql & " and category_id not in ('1005','1006') order by zone_name"
    RS.open Mysql, MyConn, adOpenForwardOnly
    CmbZone.Clear
    cmbbranch.Clear
    Do While Not RS.EOF
        CmbZone.AddItem RS(0) & Space(80) & "#" & RS(1)
        RS.MoveNext
    Loop
    RS.Close
    Set RS = Nothing
    Reg_id = MyRegionCode
    Zon_id = ""
    b_id = ""
    CmbZone.AddItem "All", 0
    CmbZone.ListIndex = 0
End If
End Sub

Private Sub cmbRegion_Click()
Call cmbRegion_Change
End Sub

Private Sub CmbSearch_Change()
Call CmbSearch_Click
End Sub

Private Sub CmbSearch_Click()
If MyTrCode <> "" Then
    If CmbSearch.ListIndex = 0 Then
        TxtSearch.Text = MyChqNo
    ElseIf CmbSearch.ListIndex = 1 Then
        TxtSearch.Text = MyFolio
    ElseIf CmbSearch.ListIndex = 2 Then
        TxtSearch.Text = MyAppNo
    ElseIf CmbSearch.ListIndex = 3 Then
        TxtSearch.Text = MyPan
    End If
End If
End Sub






Private Sub CmbZone_Change()
Dim RS As New ADODB.Recordset, Mysql As String
Dim RS1 As New ADODB.Recordset, mysql1 As String
Dim Str() As String



MyRegionCode = ""
If CmbRegion.Text <> "" And UCase(CmbRegion.Text) <> "ALL" Then
    strbranch = Split(CmbRegion.Text, "#")
    MyRegionCode = strbranch(1)
End If

MyZoneCode = ""
If CmbZone.Text <> "" And UCase(CmbZone.Text) <> "ALL" Then
    strbranch = Split(CmbZone.Text, "#")
    MyZoneCode = strbranch(1)
End If


Mysql = "select branch_name,branch_code from branch_master where 1=1"
If GlbDataFilter <> "72" Then Mysql = Mysql & " and branch_code in (" & Branches & ")"
If CmbRegion.Text <> "All" Then Mysql = Mysql & " and Region_id='" & MyRegionCode & "'"
If CmbZone.Text <> "All" Then Mysql = Mysql & " and zone_id='" & MyZoneCode & "'"
'If Cmb_branch_cat.Text <> "All" Then Mysql = Mysql & " and branch_tar_cat='" & Trim(Mid(Cmb_branch_cat.Text, 52)) & "'"
Mysql = Mysql & " and category_id not in ('1005','1006') order by branch_name"
RS.open Mysql, MyConn
cmbbranch.Clear
Do While Not RS.EOF
    cmbbranch.AddItem RS(0) & Space(80) & "#" & RS(1)
    RS.MoveNext
Loop
RS.Close
cmbbranch.AddItem "All", 0
cmbbranch.ListIndex = 0
Set RS = Nothing
End Sub


Private Sub CmbZone_Click()
Call CmbZone_Change
End Sub

Private Sub cmdAudit_Click()
Dim MyTrCode As String
    MyTrCode = VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 0)
    If MyTrCode <> "" Then
        MyConn.Execute ("Update Transaction_mf_temp1 set audit_flag='Y' where tran_code='" & MyTrCode & "'")
    End If
    MsgBox "Audited Successfully", vbInformation
End Sub

Private Sub cmdFind_Click()
Dim kCount As Integer
    Dim KCount_cOL As Integer
    Dim Column_name As Integer
    Dim KCount_Row As Integer
    Glb_Flag_First_Time = True
    If Trim(txtFind.Text) = "" Then
        Glb_L_SearchIndex = 1
        Exit Sub
    End If
     Clear_Previously_Selected
     For kCount = Glb_L_SearchIndex To VSFCommGrdK.Rows - 1
        If InStr(1, UCase(VSFCommGrdK.TextMatrix(kCount, ColumnIndex)), UCase(txtFind.Text)) > 0 Then
            Glb_Comming_From_Search = True
            VSFCommGrdK.Row = kCount
            If kCount > 12 Then VSFCommGrdK.TopRow = kCount
            For KCount_cOL = 1 To VSFCommGrdK.Cols - 1
                Glb_Comming_From_Search = True
                VSFCommGrdK.Col = KCount_cOL
                VSFCommGrdK.CellBackColor = vbWhite
                VSFCommGrdK.FontBold = True
                VSFCommGrdK.CellForeColor = vbRed
                VSFCommGrdK.CellFontBold = True
            Next
            Glb_L_SearchIndex = kCount + 1
            Glb_Selected_row = kCount
            VSFCommGrdK.TopRow = kCount
            Exit Sub
       End If
    Next
    If kCount >= VSFCommGrdK.Rows - 1 Then
        MsgBox "No Such Record Found", vbInformation, "Search Completed"
        txtFind.Text = ""
        txtFind.SetFocus
        Glb_L_SearchIndex = 1
        Glb_Selected_row = 0
    End If
End Sub

Private Sub CMDRESET_Click()
    TxtBusiCodeA = ""
    CmbAmcA.ListIndex = -1
    TxtBranchA.Text = ""
    TxtPanA.Text = ""
    TxtSchemeA.Text = ""
    ImEntryDtF.Text = Format(Now, "DD/MM/YYYY")
    cmbTranTypeA.Text = ""
    TxtAppnoA.Text = ""
    txtInvestorA.Text = ""
    TxtClientCodeA.Text = ""
    txtChqNo.Text = ""
    dtChqDate.Text = Format(Now, "DD/MM/YYYY")
    TxtAmountA = ""
    CmbSipStpA.Text = ""
    Lbl_Leadno.Caption = ""
    lbl_lead_caption.Caption = ""
    MyTranCode = ""
    MyBranchCode = ""
    TxtBusiCodeM = ""
End Sub

Private Sub cmdGo_Click()
If MyTranCode = "" Then
   MsgBox "Please Select Any Record First", vbInformation
   Exit Sub
End If

CmdGo.Enabled = False
MyTotalAmount1 = 0
MyTotalMargin1 = 0
MyTotalTrans1 = 0
Call gridfill(1)
CmdGo.Enabled = True
End Sub

Private Sub CmdGo1_Click()
cmbbranchAr.ListIndex = cmbbranch.ListIndex
MyBranchCode = ""
If cmbbranch.Text <> "" And UCase(cmbbranch.Text) <> "ALL" Then
    strbranch = Split(cmbbranch.Text, "#")
    MyBranchCode = strbranch(1)
End If

MyRegionCode = ""
If CmbRegion.Text <> "" And UCase(CmbRegion.Text) <> "ALL" Then
    strbranch = Split(CmbRegion.Text, "#")
    MyRegionCode = strbranch(1)
End If

MyZoneCode = ""
If CmbZone.Text <> "" And UCase(CmbZone.Text) <> "ALL" Then
    strbranch = Split(CmbZone.Text, "#")
    MyZoneCode = strbranch(1)
End If

MyRmCode = ""
If CmbRM.Text <> "" And UCase(CmbRM.Text) <> "ALL" Then
    strbranch = Split(CmbRM.Text, "#")
    MyRmCode = strbranch(1)
End If

MyMutCode = ""
If CmbAmcTR.Text <> "" And UCase(CmbAmcTR.Text) <> "ALL" Then
    strbranch = Split(CmbAmcTR.Text, "#")
    MyMutCode = strbranch(1)
End If


CmdGo1.Enabled = False
MyTotalAmount2 = 0
MyTotalmargin2 = 0
MyTotalTrans2 = 0
Call gridfill(2)
CmdGo1.Enabled = True
End Sub

'Private Sub CmdMissingReport_Click()
'On Error GoTo err
'Dim cnt As Integer
'cnt = 0
'If VSFCommGrdT.Rows > 1 Then
'    For i = 1 To VSFCommGrdT.Rows - 1
'        Screen.MousePointer = vbHourglass
'        If VSFCommGrdT.TextMatrix(i, 18) <> "" Then
'            If VSFCommGrdT.TextMatrix(i, 18) = 1 Then
'                MyConn.Execute "Update TRANSACTION_MF_TEMP1 set MISSING ='YES' where TRAN_CODE='" & VSFCommGrdT.TextMatrix(i, 10) & "'"
'                MyConn.Execute "insert into temp_mail (tran_code) values('" & VSFCommGrdT.TextMatrix(i, 10) & "')"
'            Else
'                MyConn.Execute "Update TRANSACTION_MF_TEMP1 set MISSING =NULL where TRAN_CODE='" & VSFCommGrdT.TextMatrix(i, 10) & "'"
'                MyConn.Execute "delete from  temp_mail  where tran_code='" & VSFCommGrdT.TextMatrix(i, 10) & "'"
'            End If
'        End If
'        If VSFCommGrdT.TextMatrix(i, 19) <> "" Then
'            If VSFCommGrdT.TextMatrix(i, 19) = 1 Then
'                MyConn.Execute "Update TRANSACTION_MF_TEMP1 set solve ='YES',sol_ref_Ar='" & VSFCommGrdT.TextMatrix(i, 20) & "',sol_date=sysdate where TRAN_CODE='" & VSFCommGrdT.TextMatrix(i, 10) & "'"
'            Else
'                MyConn.Execute "Update TRANSACTION_MF_TEMP1 set solve =NULL,sol_ref_Ar=null,sol_date=null where TRAN_CODE='" & VSFCommGrdT.TextMatrix(i, 10) & "'"
'            End If
'        End If
'        Screen.MousePointer = vbNormal
'    Next
'    '-------------------------MAIL------------------------
'    cnt = SqlRet("select count(*) from transaction_mf_temp1 where tran_code in(select tran_code from temp_mail) and mflag IS NULL ")
'    Call SendMails
'    '-------------------------------------------------
'    MsgBox cnt & " Missing Transactions have been reported to HO. For further follows, write to Operations Group - shashir@bajajcapital.com", vbInformation
'End If
'MyConn.Execute "update transaction_mf_temp1 set mflag='YES' where tran_code in(select tran_code from temp_mail)"
'MyConn.Execute ("delete from  temp_mail ")
'Exit Sub
'err:
'    MsgBox err.Description
'    'resume
'End Sub
Private Sub SendMails()
On Error GoTo Mah
Dim Str() As String
Dim rsType As New ADODB.Recordset
Dim RsSplit As New ADODB.Recordset
Dim count As Integer
Dim Mysql As String
Dim rsRm As New ADODB.Recordset
Dim rcp As String, MailFlg As Boolean
Dim rmvFl As New filesystemobject
count = 0
'l6.Caption = 0
rsType.CursorLocation = adUseClient
RsSplit.CursorLocation = adUseClient
rsType.open "select distinct rm_name,business_rmcode,branch_name from tempmail where tran_code in(select tran_code from temp_mail) and mflag IS NULL ", MyConn, adOpenForwardOnly
While Not rsType.EOF
    MyRmName = rsType.Fields("rm_name")
    MyBusiCode = rsType.Fields("business_rmcode")
    MyBranch = rsType.Fields("branch_name")
    rcp = "shashir@bajajcapital.com"
    'rcp = "pankajpundir@bajajcapital.com"
    Set poSendMail = New clsSendMail
    If poSendMail.IsValidEmailAddress(rcp) = True Then
       MailFlg = True
       With poSendMail
            .SMTPHostValidation = VALIDATE_NONE         ' Optional, default = VALIDATE_HOST_DNS
            .EmailAddressValidation = VALIDATE_SYNTAX   ' Optional, default = VALIDATE_SYNTAX
            .Delimiter = ";"                            ' Optional, default = ";" (semicolon)
            .SMTPHost = "mail.bajajcapital.com"                 ' Required the fist time, optional thereafter
            .From = "wealthmaker@bajajcapital.com"          ' Required the fist time, optional thereafter
            .FromDisplayName = "Wealthmaker"                ' Optional, saved after first use
            .Recipient = rcp    ' Required, separate multiple entries with delimiter character"
            .RecipientDisplayName = rcp ' Optional, separate multiple entries with delimiter character"
            .BccRecipient = "nidhic@bajajcapital.com" ';jijyo@bajajcapital.com
            .CcRecipient = "harshn@bajajcapital.com;harishs@bajajcapital.com;anjaneyakg@bajajcapital.com"
            .Subject = "Missing MF Transactions Reported on " & ServerDateTime & " by " & MyRmName & "( " & MyBusiCode & " ) - " & MyBranch & "" ' Optional
             Call MessageZonal
            .Message = strmsg                             ' Optional
            '.Attachment = App.Path & "\reports\siprenewal.jpg"           ' Optional, separate multiple entries with delimiter character
            .AsHTML = True                           ' Optional, default = FALSE, send mail as html or plain text
            .ContentBase = ""                           ' Optional, default = Null String, reference base for embedded links
            .EncodeType = MyEncodeType                  ' Optional, default = MIME_ENCODE
            .Priority = etPriority                      ' Optional, default = PRIORITY_NORMAL
            .Receipt = False                         ' Optional, default = FALSE
            .UseAuthentication = True             ' Optional, default = FALSE
            .UsePopAuthentication = True           ' Optional, default = FALSE
            .UserName = "troubleticket"                     ' Optional, default = Null String
            .Password = "bajajcap"                     ' Optional, default = Null String, value is NOT saved
            .POP3Host = "mail.bajajcapital.com"
            .MaxRecipients = 100                        ' Optional, default = 100, recipient count before error is raised
            .ConnectTimeout = 100                      ' Optional, default = 10
            .ConnectRetry = 10                         ' Optional, default = 5
            .MessageTimeout = 100                      ' Optional, default = 60
            .SMTPPort = 587                            ' Optional, default = 25
            .send                                       ' Required
            .Disconnect                               ' Optional, use when sending bulk mail
      End With
    End If
    Set poSendMail = Nothing
    count = count + 1
    DoEvents
    rsType.MoveNext
   ' myconn.Execute ("UPDATE temp_mail SET MFLAG='YES' WHERE rm_name='" & MyRmName & "'")
     'MsgBox "Email has been sent to " & MyRmName
Wend
    Exit Sub
Mah:
    PrintToTrace " -- Sip Renewal Mail Error " & err.Description
End Sub
Private Sub MessageZonal()
Dim MyTotalPmt As Long
Dim MyTotalMargin As Long
Dim flage As Boolean
Dim StrMsg1 As String
Dim rsVar1 As New ADODB.Recordset
Dim sql As String, rsVar As New ADODB.Recordset
Dim add2 As String, City As String, pin As String, Folio As String, scheme As String, nav As String
strmsg = "select rownum,a.* from tempmail a,temp_mail b where a.tran_code = b.tran_code  and a.rm_name='" & MyRmName & "' and a.mflag IS NULL "
If rsVar.State = 1 Then rsVar.Close
rsVar.open strmsg, MyConn, adOpenStatic, adLockReadOnly
StrMsg1 = "select sum(amount)sum from tempmail a,temp_mail b where a.tran_code = b.tran_code and a.rm_name='" & MyRmName & "' and a.mflag IS NULL "
If rsVar1.State = 1 Then rsVar1.Close
rsVar1.open StrMsg1, MyConn, adOpenStatic, adLockReadOnly
'---------------------------------------------------------------------------------------------
strmsg = " <HTML> "
strmsg = strmsg & "<HEAD> "
strmsg = strmsg & "<META HTTP-EQUIV=""Content-Type"" CONTENT=""text/html; charset=windows-1252""> "
strmsg = strmsg & "<META NAME=""Generator"" CONTENT=""Microsoft FrontPage 5.0""> "
strmsg = strmsg & "<TITLE>Dear J Kodeeswari </TITLE> "
strmsg = strmsg & "</HEAD> "
strmsg = strmsg & "<BODY> "
strmsg = strmsg & "<FONT FACE=""Arial"" SIZE=4><P align=""center""><B><U>Missing MF Temporary Transaction</B></U></P> "
strmsg = strmsg & "<FONT FACE=""Arial"" SIZE=2><P>Following are the Missing Transactions Reported by  <B><U>" & MyRmName & " ( " & MyBusiCode & " )</B></U> ( <B>" & MyBranch & " )</B></P> "
strmsg = strmsg & "<TABLE BORDER CELLSPACING=0 CELLPADDING=2 VALIGN=CENTER BGCOLOR=FFFFE1 BORDERCOLOR=ECE9D8 > "
strmsg = strmsg & "<tr><TD WIDTH=""1%"" BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>S No.</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%"" BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>TR No.</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""3%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>TR Date</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>PAN</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>Account No.</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>Client Code</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>ANA Code</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>Investor Code</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>Investor</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""10%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>AMC/Scheme</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""3%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>Amount</STRONG></FONT></TD> "
strmsg = strmsg & "<TD WIDTH=""2%""  BGCOLOR=#333399 ALIGN=LEFT><FONT  COLOR=#FFFFE1 size=1 ><STRONG>SIP Type</STRONG></FONT></TD></tr> "

While Not rsVar.EOF
        strmsg = strmsg & "<TR> "
        strmsg = strmsg & "<TD WIDTH=""1%"" BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("rownum") & "</FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%"" BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("tran_code") & "</FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""3%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("tr_date") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & UCase(rsVar.Fields("panno")) & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("ac_holder_code") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & Mid(rsVar.Fields("client_codec"), 1, 8) & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("exist_code") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("client_code") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("investor_name") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""10%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > " & rsVar.Fields("scheme_name") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""3%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("amount") & " </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""2%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 >" & rsVar.Fields("sip_type") & " </FONT></TD> </tr>"
        rsVar.MoveNext
        DoEvents
Wend
        strmsg = strmsg & "<TR> "
        strmsg = strmsg & "<TD WIDTH=""1%"" BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 ></FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""2%"" BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 ></FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""3%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""10%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 ><STRONG><B>TOTAL</B> </STRONG></FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""4%"" BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 ><B>" & rsVar1.Fields("sum") & "</B></FONT></TD> "
        strmsg = strmsg & "<TD WIDTH=""2%""  BGCOLOR=#e1f5ff ALIGN=LEFT><FONT  COLOR=#000000 size=1 > </FONT></TD> </tr>"
        strmsg = strmsg & "</table> "
        strmsg = strmsg & "</BODY> "
        strmsg = strmsg & "</HTML> "
        rsVar.Close
        Set rsVar = Nothing
End Sub

Private Sub CmdUnmap_Click()
If MyTrCode = "" Then
    MsgBox "First Double Click The Record , You Want To Map", vbInformation
    Exit Sub
End If
If MyRtaTrCode = "" Then
    MsgBox "First Double Click The Record , To Which You Want To Map", vbInformation
    Exit Sub
End If
If MyDispatch = "N" Then
    MyConn.Execute ("Update Transaction_mf_temp1 set remark_reco=null,PROCESSED=NULL,amount=orig_amount, REC_FLAG=NULL,RECO_DATE=NULL,REC_USER=NULL,RTA_TRAN_CODE=NULL WHERE TRAN_CODE='" & MyTrCode & "'")
    MyConn.Execute ("Update Transaction_mf_temp1 set remark_reco=null,PROCESSED=NULL,amount=orig_amount, REC_FLAG=NULL,RECO_DATE=NULL,REC_USER=NULL,RTA_TRAN_CODE=NULL WHERE BASE_TRAN_CODE='" & MyTrCode & "'")
    MyConn.Execute ("Update Transaction_st@MF.BAJAJCAPITAL set REC_FLAG=NULL,HO_TRAN_CODE=NULL where tran_code in(" & MyRtaTrCode & ")")
Else
    MyConn.Execute ("Update Transaction_mf_temp1 set remark_reco=null,PROCESSED=NULL,amount=orig_amount, REC_FLAG=NULL,RECO_DATE=NULL,REC_USER=NULL,RTA_TRAN_CODE=NULL WHERE TRAN_CODE='" & MyTrCode & "'") ', tr_date=ar_date
    MyConn.Execute ("Update Transaction_mf_temp1 set remark_reco=null,PROCESSED=NULL,amount=orig_amount, REC_FLAG=NULL,RECO_DATE=NULL,REC_USER=NULL,RTA_TRAN_CODE=NULL WHERE BASE_TRAN_CODE='" & MyTrCode & "'") ',tr_date=ar_date
    MyConn.Execute ("Update Transaction_st@MF.BAJAJCAPITAL set REC_FLAG=NULL,HO_TRAN_CODE=NULL where tran_code in(" & MyRtaTrCode & ")")
End If
MsgBox "Record Is Unreconciled Sucessfully", vbInformation
End Sub

Private Sub cmdReset1_Click()
cmbbranchAr.ListIndex = -1
MyRtaTrCode = ""
CmbOrder.ListIndex = -1
Option1(0).Value = True
If MySelectedRow > 0 Then
    VSFCommGrdK.Row = MySelectedRow
    For KCount_cOL = 0 To VSFCommGrdK.Cols - 1
         VSFCommGrdK.Col = KCount_cOL
          VSFCommGrdK.CellBackColor = vbWhite
          VSFCommGrdK.CellForeColor = vbBlack
          VSFCommGrdK.CellFontBold = False
    Next
End If
End Sub

Private Sub cmdReset2_Click()
cmbbranch.ListIndex = 0
CmbOrder1.ListIndex = 0
'OptReconcileTR.Value = True
OptReconcileAR.Value = True
OptAutoRecon.Value = True
Option1(2).Value = True
If MySelectedRow1 > 0 Then
    VSFCommGrdT.Row = MySelectedRow1
    For KCount_cOL = 0 To VSFCommGrdT.Cols - 1
         VSFCommGrdT.Col = KCount_cOL
          VSFCommGrdT.CellBackColor = vbWhite
          VSFCommGrdT.CellForeColor = vbBlack
          VSFCommGrdT.CellFontBold = False
    Next
End If
MyTrCode = ""
End Sub

'Private Sub cmdSave_Click()
'On Error GoTo err
'Dim str() As String
'For DoGrid = 1 To VSFCommGrdK.Rows - 1
'    If VSFCommGrdK.TextMatrix(DoGrid, 10) <> "" And VSFCommGrdK.TextMatrix(DoGrid, 11) <> "" Then
'        If Val(VSFCommGrdK.TextMatrix(DoGrid, 11)) <> 0 Then
'            MyConn.Execute "delete from MFDEALSPECIFIC_PAID where tran_code='" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "'"
'            MyConn.Execute "delete from DEALSPECIFIC_PAID where tran_code='" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "' and flag='YES'"
'            sql = "Insert Into MFDEALSPECIFIC_PAID(tran_code, receivable, expense,margin, RATETYPE, rate, USERID, TIMEST)"
'            sql = sql & " VALUES('" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "'," & Val(VSFCommGrdK.TextMatrix(DoGrid, 9)) & ","
'            sql = sql & " " & Val(VSFCommGrdK.TextMatrix(DoGrid, 12)) & "," & Val(VSFCommGrdK.TextMatrix(DoGrid, 13)) & ","
'            sql = sql & " '" & VSFCommGrdK.TextMatrix(DoGrid, 10) & "'," & Val(VSFCommGrdK.TextMatrix(DoGrid, 11)) & ","
'            sql = sql & " '" & Glbloginid & "',to_date('" & Format(ServerDateTime, "dd/mm/yyyy") & "','dd/mm/yyyy'))"
'            MyConn.Execute sql
'
'            sql = "INSERT INTO DEALSPECIFIC_PAID (PAID_CAL_ON,DEAL_BROK_TYPE,PER_RS,FIGURE,TRAN_CODE,LOGGEDUSERID,TIMEST,FLAG)"
'            sql = sql & " VALUES('Amount Invested','Upfront','" & VSFCommGrdK.TextMatrix(DoGrid, 10) & "'," & Val(VSFCommGrdK.TextMatrix(DoGrid, 11)) & ",'" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "',"
'            sql = sql & "'" & Glbloginid & "',to_date('" & Format(ServerDateTime, "dd/mm/yyyy") & "','dd/mm/yyyy'),'YES')"
'            MyConn.Execute sql
'        Else
'            MyConn.Execute "delete from MFDEALSPECIFIC_PAID where tran_code='" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "'"
'            MyConn.Execute "delete from DEALSPECIFIC_PAID where tran_code='" & VSFCommGrdK.TextMatrix(DoGrid, 14) & "' and flag='YES'"
'        End If
'        '*******************FOR BROK RECD_PAID
'        Dim recd_paid As New ADODB.Command
'        Set recd_paid.ActiveConnection = MyConn
'        recd_paid.CommandType = adCmdStoredProc
'        recd_paid.CommandText = "Recd_paid_update"
'        recd_paid.Parameters.Append recd_paid.CreateParameter("tr_code", adVarChar, adParamInput, 50, Trim(VSFCommGrdK.TextMatrix(DoGrid, 14)))
'        recd_paid.Execute
'        '''''******************************end
'    End If
'Next
'MsgBox "The Record Has Been Saved Successfully"
'Exit Sub
'err:
'MsgBox err.Description
'End Sub
Private Sub cmdview_Click()
Call gridfill(2)
End Sub



Private Sub EmdExit_Click()
Unload Me
End Sub

Private Sub Form_Load()
mskfromdt.Text = Format(Now, "DD/MM/YYYY")
msktodt.Text = Format(Now, "DD/MM/YYYY")
MySelectedRow = -1
mskfromdt1.Text = Format(Now, "DD/MM/YYYY")
msktodt1.Text = Format(Now, "DD/MM/YYYY")
Call SetGrid
Dim RsData As New ADODB.Recordset
CmbOrder.Clear
CmbOrder.AddItem "Select", 0
CmbOrder.AddItem "Investor Name", 1
CmbOrder.AddItem "Scheme Name", 2
CmbOrder.AddItem "Amount", 3
CmbOrder.AddItem "Cheque No", 4
CmbOrder.AddItem "Trans Type", 5
CmbOrder.AddItem "Trans Date", 6
CmbOrder.AddItem "Folio No", 7
CmbOrder.ListIndex = 0

CmbSearch.AddItem "Cheque No", 0
CmbSearch.AddItem "Folio No", 1
CmbSearch.AddItem "App No", 2
CmbSearch.AddItem "PAN No", 3
CmbSearch.ListIndex = 0

OptAutoRecon.Value = True
OptReconcileAR.Value = True

CmbOrder1.Clear
CmbOrder1.AddItem "Select", 0
CmbOrder1.AddItem "Investor Name", 1
CmbOrder1.AddItem "Scheme Name", 2
CmbOrder1.AddItem "Amount", 3
CmbOrder1.AddItem "Cheque No", 4
CmbOrder1.AddItem "Tran Type", 5
CmbOrder1.AddItem "Tran Date", 6
CmbOrder1.AddItem "RM Name", 7
CmbOrder1.ListIndex = 0

'If GlbroleId = 17 Or GlbroleId = 1 Then
'CmdMissingReport.Enabled = True
'Else
'    CmdMissingReport.Enabled = False
'End If
'------------------------------------TR BRANCH FILL---------------------------------------------------------------------
Set rs_branch = New ADODB.Recordset
If rs_branch.State = 1 Then rs_branch.Close
If Trim(Branches) <> "" Then
    rs_branch.open "select branch_name,branch_code from branch_master where branch_code in (" & Branches & ") and category_id not in ('1004','1005','1006') order by branch_name", MyConn, adOpenForwardOnly, adLockReadOnly
Else
    rs_branch.open "select branch_name,branch_code from branch_master and category_id not in ('1004','1005','1006')  order by branch_name", MyConn, adOpenForwardOnly, adLockReadOnly
End If
If rs_branch.RecordCount > 0 Then
    With cmbbranch
        For i = 0 To rs_branch.RecordCount - 1
            .AddItem rs_branch(0) & Space(80) & "#" & rs_branch(1)
            rs_branch.MoveNext
        Next
    End With
End If
cmbbranch.AddItem "ALL", 0
rs_branch.Close
Set rs_branch = Nothing

'region fill
Mysql = "select region_name,region_id from region_master where region_id in (select region_id from branch_master where branch_code in (" & Branches & ")) order by region_name"
RsData.open Mysql, MyConn, adOpenForwardOnly
CmbRegion.Clear
Do While Not RsData.EOF
     CmbRegion.AddItem RsData(0) & Space(50 - Len(RsData(0))) & "#" & RsData(1)
     RsData.MoveNext
Loop
RsData.Close
CmbRegion.AddItem "All", 0
CmbRegion.ListIndex = 0
Set RsData = Nothing
    
'AMC fill
Mysql = "select MUT_NAME,MUT_CODE from MUT_FUND order by MUT_name"
RsData.open Mysql, MyConn, adOpenForwardOnly
CmbAmcTR.Clear
Do While Not RsData.EOF
     CmbAmcTR.AddItem RsData(0) & Space(80) & "#" & RsData(1)
     CmbAmcAR.AddItem RsData(0) & Space(80) & "#" & RsData(1)
     RsData.MoveNext
Loop
RsData.Close
CmbAmcTR.AddItem "All", 0
CmbAmcTR.ListIndex = 0
CmbAmcAR.AddItem "All", 0
CmbAmcAR.ListIndex = 0
Set RsData = Nothing
'------------------------------------------------------------------------------------------------------------------------
'------------------------------------AR BRANCH FILL---------------------------------------------------------------------
Set rs_branch = New ADODB.Recordset
If rs_branch.State = 1 Then rs_branch.Close
If Trim(Branches) <> "" Then
    rs_branch.open "select branch_name,branch_code from branch_master where branch_code in (" & Branches & ") and category_id not in ('1005','1006') order by branch_name", MyConn, adOpenForwardOnly, adLockReadOnly
Else
    rs_branch.open "select branch_name,branch_code from branch_master and category_id not in ('1005','1006')  order by branch_name", MyConn, adOpenForwardOnly, adLockReadOnly
End If
If rs_branch.RecordCount > 0 Then
    With cmbbranchAr
        For i = 0 To rs_branch.RecordCount - 1
            .AddItem rs_branch(0) & Space(80) & "#" & rs_branch(1)
            rs_branch.MoveNext
        Next
    End With
End If
cmbbranchAr.AddItem "ALL", 0
cmbbranchAr.ListIndex = 0
rs_branch.Close
Set rs_branch = Nothing
End Sub
Private Sub CmbOrder_Click()
MyOrder = ""
If CmbOrder.ListIndex = 1 Then
   MyOrder = "Investor_Name"
ElseIf CmbOrder.ListIndex = 2 Then
    MyOrder = "Scheme_Name"
ElseIf CmbOrder.ListIndex = 3 Then
    MyOrder = "Amount"
ElseIf CmbOrder.ListIndex = 4 Then
    MyOrder = "Cheque_No"
ElseIf CmbOrder.ListIndex = 5 Then
    MyOrder = "Tran_Type"
ElseIf CmbOrder.ListIndex = 6 Then
    MyOrder = "tr_date"
ElseIf CmbOrder.ListIndex = 7 Then
    MyOrder = "Folio_No"
End If
End Sub
Private Sub CmbOrder1_Click()
MyOrder1 = ""
If CmbOrder1.ListIndex = 1 Then
   MyOrder1 = "Investor_Name"
ElseIf CmbOrder1.ListIndex = 2 Then
    MyOrder1 = "Scheme_Name"
ElseIf CmbOrder1.ListIndex = 3 Then
    MyOrder1 = "Amount"
ElseIf CmbOrder1.ListIndex = 4 Then
    MyOrder1 = "Cheque_no"
ElseIf CmbOrder1.ListIndex = 5 Then
    MyOrder1 = "Tran_Type"
ElseIf CmbOrder1.ListIndex = 6 Then
    MyOrder1 = "tr_date"
ElseIf CmbOrder1.ListIndex = 7 Then
    MyOrder1 = "rm_name"
End If
End Sub

Private Sub SetGrid()
 s = "TranCode|^TrDate|^InvestorName|^Address|^City|^Amc|^Scheme|^Amount|^FolioNo|^ChequeNO|^AppNo|^RM|^Branch|^BrokerCode|^MutCode|^SchCode"
 VSFCommGrdK.FormatString = s
 VSFCommGrdK.ColWidth(0) = 1500 'TranCode
 VSFCommGrdK.ColWidth(1) = 1500 'Date
 VSFCommGrdK.ColWidth(2) = 2500 'InvName
 VSFCommGrdK.ColWidth(3) = 4000 'Address
 VSFCommGrdK.ColWidth(4) = 1200 'city
 VSFCommGrdK.ColWidth(5) = 2000 'amc
 VSFCommGrdK.ColWidth(6) = 5000 'scheme
 VSFCommGrdK.ColWidth(7) = 1500 'amt
 VSFCommGrdK.ColWidth(8) = 1200 'fol_no
 VSFCommGrdK.ColWidth(9) = 1500 'chq_no
 VSFCommGrdK.ColWidth(10) = 1500 'app_no
 VSFCommGrdK.ColWidth(11) = 1500 'rm
 VSFCommGrdK.ColWidth(12) = 1500 'branch
 VSFCommGrdK.ColWidth(13) = 1200 'subcode
 VSFCommGrdK.ColWidth(14) = 0 'mutcode
 VSFCommGrdK.ColWidth(15) = 0 'mutcode
 'VSFCommGrdK.ColWidth(16) = 1500 'Trcode
 VSFCommGrdK.ColEditMask(1) = "##/##/####"
 VSFCommGrdK.ColAlignment(0) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(1) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(2) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(3) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(4) = flexAlignRightCenter
 VSFCommGrdK.ColAlignment(5) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(6) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(7) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(8) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(9) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(10) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(11) = flexAlignLeftCenter
 VSFCommGrdK.ColAlignment(12) = flexAlignLeftCenter
 
 s1 = "TranCode|^TrDate|^InvestorName|^Address|^City|^Amc|^Scheme|^Amount|^FolioNo|^ChequeNO|^AppNo|^RM|^Branch|^MutCode|^SchCode"
 VSFCommGrdT.FormatString = s1
 VSFCommGrdT.ColWidth(0) = 1500 'TranCode
 VSFCommGrdT.ColWidth(1) = 1500 'Date
 VSFCommGrdT.ColWidth(2) = 2500 'InvName
 VSFCommGrdT.ColWidth(3) = 4000 'Address
 VSFCommGrdT.ColWidth(4) = 1200 'city
 VSFCommGrdT.ColWidth(5) = 2000 'amc
 VSFCommGrdT.ColWidth(6) = 5000 'scheme
 VSFCommGrdT.ColWidth(7) = 1500 'amt
 VSFCommGrdT.ColWidth(8) = 1200 'fol_no
 VSFCommGrdT.ColWidth(9) = 1500 'chq_no
 VSFCommGrdT.ColWidth(10) = 1500 'app_no
 VSFCommGrdT.ColWidth(11) = 1500 'rm
 VSFCommGrdT.ColWidth(12) = 1500 'branch
 VSFCommGrdT.ColWidth(13) = 0 'mutcode
 VSFCommGrdT.ColWidth(14) = 0 'schcode
 VSFCommGrdT.ColEditMask(1) = "##/##/####"
 VSFCommGrdT.ColAlignment(0) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(1) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(2) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(3) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(4) = flexAlignRightCenter
 VSFCommGrdT.ColAlignment(5) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(6) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(7) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(8) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(9) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(10) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(11) = flexAlignLeftCenter
 VSFCommGrdT.ColAlignment(12) = flexAlignLeftCenter
End Sub

Private Sub mskfromdt1_LostFocus()
mskfromdt.Text = mskfromdt1.Text
End Sub


Private Sub msktodt1_LostFocus()
msktodt.Text = msktodt1.Text
End Sub




















'Private Sub OPtAmount_Click()
'If MyTrCode <> "" And optAmount.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OptAppAmt_Click()
'If MyTrCode <> "" And OptAppAmt.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OptAppNo_Click()
'If MyTrCode <> "" And OptAppNo.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OPtChqAmt_Click()
'If MyTrCode <> "" And OPtChqAmt.Value = True Then Call cmdGo_Click
'End Sub


'Private Sub OptChqNo_Click()
'If MyTrCode <> "" And OptChqNo.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OptFolAmt_Click()
'If MyTrCode <> "" And OptFolAmt.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OPtFolNo_Click()
'If MyTrCode <> "" And OPtFolNo.Value = True Then Call cmdGo_Click
'End Sub

'Private Sub OPtPan_Click()
'If MyTrCode <> "" And OptPan.Value = True Then Call cmdGo_Click
'End Sub


'Private Sub OPtPanAmt_Click()
'If MyTrCode <> "" And OPtPanAmt.Value = True Then Call cmdGo_Click
'End Sub


Private Sub VSFCommGrdK_Click()
On Error Resume Next
ColumnIndex = VSFCommGrdK.Col
Clear_Previously_Selected1
Glb_L_SearchIndex1 = 1
Glb_Selected_row1 = 0
Label6(0).Caption = "" & VSFCommGrdK.TextMatrix(0, VSFCommGrdK.Col)

MyCurrRow = VSFCommGrdK.Row
If VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 0) <> "" Then
      If MySelectedRow > 0 Then
          VSFCommGrdK.Row = MySelectedRow
          For KCount_cOL = 0 To VSFCommGrdK.Cols - 1
               VSFCommGrdK.Col = KCount_cOL
                VSFCommGrdK.CellBackColor = vbWhite
                VSFCommGrdK.CellForeColor = vbBlack
                VSFCommGrdK.CellFontBold = False
          Next
      End If
      VSFCommGrdK.Row = MyCurrRow
      For KCount_cOL = 0 To VSFCommGrdK.Cols - 1
        VSFCommGrdK.Col = KCount_cOL
        If VSFCommGrdK.CellBackColor = vbBlue Then
            VSFCommGrdK.CellBackColor = vbWhite
            VSFCommGrdK.CellForeColor = vbBlack
            VSFCommGrdK.CellFontBold = False
            If KCount_cOL = 18 Or KCount_cOL = 19 Then
                VSFCommGrdK.CellForeColor = vbWhite
            End If
        Else
            VSFCommGrdK.CellBackColor = vbBlue
            VSFCommGrdK.CellForeColor = vbWhite
            MySelectedRow = VSFCommGrdK.Row
            'VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 16) = MyTrCode
            VSFCommGrdK.CellFontBold = True
            If KCount_cOL = 18 Or KCount_cOL = 19 Then
                VSFCommGrdK.CellForeColor = vbBlue
            End If
        End If
        If KCount_cOL = 18 Then
            If VSFCommGrdK.CellPicture = Image1.Picture Then
                Exit Sub
            End If
            If VSFCommGrdK.CellPicture = Image2.Picture Then
                Set VSFCommGrdK.CellPicture = Image22.Picture
                VSFCommGrdK.CellPictureAlignment = flexPicAlignCenterCenter
                VSFCommGrdK.Text = 1
            Else
                 Set VSFCommGrdK.CellPicture = Image2.Picture
                 VSFCommGrdK.CellPictureAlignment = flexPicAlignCenterCenter
                 VSFCommGrdK.Text = 0
            End If
        End If
    Next
End If
MyRtaTrCode = ""
MyRtaTrDate = ""
MyRtaTrCode = VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 0)
MyRtaTrDate = VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 1)

End Sub

Private Sub VSFCommGrdK_DblClick()
'MyCurrRow = VSFCommGrdK.Row
'If VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 0) <> "" Then
'      If MySelectedRow > 0 Then
'          VSFCommGrdK.Row = MySelectedRow
'          For KCount_cOL = 0 To VSFCommGrdK.Cols - 1
'               VSFCommGrdK.Col = KCount_cOL
'                VSFCommGrdK.CellBackColor = vbWhite
'                VSFCommGrdK.CellForeColor = vbBlack
'                VSFCommGrdK.CellFontBold = False
'          Next
'      End If
'      VSFCommGrdK.Row = MyCurrRow
'      For KCount_cOL = 0 To VSFCommGrdK.Cols - 1
'        VSFCommGrdK.Col = KCount_cOL
'        If VSFCommGrdK.CellBackColor = vbBlue Then
'            VSFCommGrdK.CellBackColor = vbWhite
'            VSFCommGrdK.CellForeColor = vbBlack
'            VSFCommGrdK.CellFontBold = False
'            If KCount_cOL = 18 Or KCount_cOL = 19 Then
'                VSFCommGrdK.CellForeColor = vbWhite
'            End If
'        Else
'            VSFCommGrdK.CellBackColor = vbBlue
'            VSFCommGrdK.CellForeColor = vbWhite
'            MySelectedRow = VSFCommGrdK.Row
'            'VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 16) = MyTrCode
'            VSFCommGrdK.CellFontBold = True
'            If KCount_cOL = 18 Or KCount_cOL = 19 Then
'                VSFCommGrdK.CellForeColor = vbBlue
'            End If
'        End If
'        If KCount_cOL = 18 Then
'            If VSFCommGrdK.CellPicture = Image1.Picture Then
'                Exit Sub
'            End If
'            If VSFCommGrdK.CellPicture = Image2.Picture Then
'                Set VSFCommGrdK.CellPicture = Image22.Picture
'                VSFCommGrdK.CellPictureAlignment = flexPicAlignCenterCenter
'                VSFCommGrdK.Text = 1
'            Else
'                 Set VSFCommGrdK.CellPicture = Image2.Picture
'                 VSFCommGrdK.CellPictureAlignment = flexPicAlignCenterCenter
'                 VSFCommGrdK.Text = 0
'            End If
'        End If
'    Next
'End If
'MyRtaTrCode = ""
'MyRtaTrDate = ""
'MyRtaTrCode = VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 0)
'MyRtaTrDate = VSFCommGrdK.TextMatrix(VSFCommGrdK.Row, 1)
End Sub
Private Sub VSFCommGrdT_AfterScroll(ByVal OldTopRow As Long, ByVal OldLeftCol As Long, ByVal NewTopRow As Long, ByVal NewLeftCol As Long)
    VSFCommGrdK.TopRow = VSFCommGrdT.TopRow
    VSFCommGrdK.LeftCol = VSFCommGrdT.LeftCol
End Sub
Private Sub VSFCommGrdT_DblClick()
Me.MousePointer = 11
MyCurrRow1 = VSFCommGrdT.Row
If VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 0) <> "" Then
      If MySelectedRow1 > 0 Then
          VSFCommGrdT.Row = MySelectedRow1
          For KCount_cOL = 0 To VSFCommGrdT.Cols - 1
               VSFCommGrdT.Col = KCount_cOL
                VSFCommGrdT.CellBackColor = vbWhite
                VSFCommGrdT.CellForeColor = vbBlack
                VSFCommGrdT.CellFontBold = False
          Next
      End If
      VSFCommGrdT.Row = MyCurrRow1
      For KCount_cOL = 0 To VSFCommGrdT.Cols - 1
        VSFCommGrdT.Col = KCount_cOL
        If VSFCommGrdT.CellBackColor = vbBlue Then
            VSFCommGrdT.CellBackColor = vbWhite
            VSFCommGrdT.CellForeColor = vbBlack
            VSFCommGrdT.CellFontBold = False
            If KCount_cOL = 18 Or KCount_cOL = 19 Then
                VSFCommGrdT.CellForeColor = vbWhite
            End If
        Else
            VSFCommGrdT.CellBackColor = vbBlue
            VSFCommGrdT.CellForeColor = vbWhite
            VSFCommGrdT.CellFontBold = True
            MySelectedRow1 = VSFCommGrdT.Row
            If KCount_cOL = 18 Or KCount_cOL = 19 Then
                VSFCommGrdT.CellForeColor = vbBlue
            End If
        End If
        If KCount_cOL = 18 Then
            If VSFCommGrdT.CellPicture = Image1.Picture Then
                Exit Sub
            End If
            If VSFCommGrdT.CellPicture = Image2.Picture Then
                Set VSFCommGrdT.CellPicture = Image22.Picture
                VSFCommGrdT.CellPictureAlignment = flexPicAlignCenterCenter
                VSFCommGrdT.Text = 1
            Else
                 Set VSFCommGrdT.CellPicture = Image2.Picture
                 VSFCommGrdT.CellPictureAlignment = flexPicAlignCenterCenter
                 VSFCommGrdT.Text = 0
            End If
        End If
    Next
End If
MyAppNo = ""
MyChqNo = ""
MyPan = ""
MyFolio = ""
MyAmount = 0
MyTrCode = ""
MyDispatch = ""
Dim Str() As String
TxtInvestorName.Text = ""
MyTrCode = VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 0)
TxtInvestorName.Text = VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 2)
MyTrDate = CDate(Format(VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 1), "dd/mm/yyyy"))
If IsNull(MyTrDate) Then
Else
    mskfromdt.Text = MyTrDate - 10
    msktodt.Text = MyTrDate + 10
End If
TxtAmount.Text = VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 7)
TxtSearch.Text = VSFCommGrdT.TextMatrix(VSFCommGrdT.Row, 9)
If MyTrCode <> "" Then
    'MyConn.Execute ("Update Transaction_mf_temp1 set PROCESSED=nvl(PROCESSED,0)+1 where tran_code='" & MyTrCode & "' ")
End If
Dim MyRs As New ADODB.Recordset
MyRs.open "Select App_no,CHEQUE_NO,panno,folio_no,amount,rta_tran_code,REMARK_RECO,DISPATCH from transaction_mf_temp1 where tran_code='" & MyTrCode & "'", MyConn, adOpenForwardOnly, adLockReadOnly
If Not MyRs.EOF Then
    MyAppNo = IIf(IsNull(MyRs.Fields("app_no")), "", MyRs.Fields("app_no"))
    MyChqNo = IIf(IsNull(MyRs.Fields("CHEQUE_NO")), "", MyRs.Fields("CHEQUE_NO"))
    MyPan = IIf(IsNull(MyRs.Fields("panno")), "", MyRs.Fields("panno"))
    MyFolio = IIf(IsNull(MyRs.Fields("folio_NO")), "", MyRs.Fields("folio_NO"))
    MyAmount = IIf(IsNull(MyRs.Fields("amount")), "", MyRs.Fields("amount"))
    MyDispatch = IIf(IsNull(MyRs.Fields("DISPATCH")), "", MyRs.Fields("DISPATCH"))
    MyTranCode = IIf(IsNull(MyRs.Fields("rta_Tran_code")), "", MyRs.Fields("rta_tran_code"))
    TxtRemarks.Text = IIf(IsNull(MyRs.Fields("REMARK_RECO")), "", MyRs.Fields("REMARK_RECO"))
Else
    TxtRemarks.Text = ""
End If
MyTempTrCode = ""
If InStr(MyTranCode, ",") <> 0 Then
    Str = Split(MyTranCode, ",")
    For i = 0 To UBound(Str)
       MyTempTrCode = MyTempTrCode & "'" & Str(i) & "',"
    Next
    MyTempTrCode = Mid(MyTempTrCode, 1, Len(MyTempTrCode) - 1)
Else
    MyTempTrCode = "'" & MyTranCode & "'"
End If
If MyTempTrCode <> "" Then
   Call cmdGo_Click
End If
Me.MousePointer = 0
End Sub

