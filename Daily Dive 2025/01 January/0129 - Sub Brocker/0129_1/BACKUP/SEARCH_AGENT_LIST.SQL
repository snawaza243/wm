create or replace PROCEDURE PSM_ASS_M_ASSO_BY_CR (
    P_BRANCH_ID IN VARCHAR2,    
    P_CITY_ID IN VARCHAR2,
    P_MOBILE IN VARCHAR2,
    P_PHONE IN VARCHAR2,
    P_ASSOCIATE_CODE IN VARCHAR2,
    P_PAN_NO IN VARCHAR2,
    P_ASSOCIATE_NAME IN VARCHAR2,
    P_ASSOCIATE_LIST OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN P_ASSOCIATE_LIST FOR
    SELECT AGENT_CODE, AGENT_NAME,EXIST_CODE, ADDRESS1, ADDRESS2, PHONE, MOBILE, EMAIL
    FROM Agent_Master
    WHERE (SOURCEID = P_BRANCH_ID OR P_BRANCH_ID IS NULL)
    AND (CITY_ID = P_CITY_ID OR P_CITY_ID IS NULL)
    AND (MOBILE = P_MOBILE OR P_MOBILE IS NULL)
    AND (PHONE = P_PHONE OR P_PHONE IS NULL)
    AND (EXIST_CODE = P_ASSOCIATE_CODE OR P_ASSOCIATE_CODE IS NULL)
    AND (PAN = P_PAN_NO OR P_PAN_NO IS NULL)
    AND (AGENT_NAME LIKE '%' || P_ASSOCIATE_NAME || '%' OR P_ASSOCIATE_NAME IS NULL)
    AND ROWNUM <200;

END;