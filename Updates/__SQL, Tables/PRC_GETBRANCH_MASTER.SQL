create or replace PROCEDURE  PRC_GETBRANCH_MASTER (   
    P_REGIONID           VARCHAR2,
    P_ZONE_ID            VARCHAR2,
    P_LOGINID            VARCHAR2,
    P_ROLEID             VARCHAR2,
    P_ERRORMESSAGE     OUT VARCHAR2,
    P_CURSOR           OUT SYS_REFCURSOR)
AS
VSQL VARCHAR2(32567);
BEGIN
    P_ERRORMESSAGE := NULL;

    BEGIN
            OPEN P_CURSOR FOR 
            SELECT BRANCH_NAME, BRANCH_CODE 
            FROM BRANCH_MASTER 
            WHERE (P_ZONE_ID IS NULL OR ZONE_ID = P_ZONE_ID) 
            AND BRANCH_CODE IN (
                SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID = P_LOGINID AND ROLE_ID = P_ROLEID
            )
            ORDER BY BRANCH_NAME ;

    EXCEPTION
        WHEN OTHERS
        THEN
            P_ERRORMESSAGE := SQLERRM (SQLCODE);

            OPEN P_CURSOR FOR SELECT '' || P_ERRORMESSAGE || '' FROM DUAL;
    END;
END;