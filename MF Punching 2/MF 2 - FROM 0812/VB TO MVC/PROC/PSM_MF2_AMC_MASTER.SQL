CREATE OR REPLACE PROCEDURE WEALTHMAKER.PSM_MF2_AMC_MASTER(
P_FOR        IN VARCHAR2,
P_BY         IN VARCHAR2,
P_BY_VALUE   IN VARCHAR2,
P_LOG_ID     IN VARCHAR2,
P_ROLE_ID    IN VARCHAR2,
P_CURSOR     OUT SYS_REFCURSOR

) IS

  V_QUERY    VARCHAR2(4000);
   
BEGIN 

    V_QUERY:= V_QUERY || ' SELECT ITEMNAME AS CHANNEL_NAME, ITEMSERIALNUMBER AS CHANNEL_CODE ';    
    V_QUERY:= V_QUERY || ' FROM FIXEDITEM ';
    V_QUERY:= V_QUERY || ' WHERE 1=1 ';
    
    IF P_FOR = 'MF_AR_MANUAL_RECO' THEN  
        V_QUERY:= V_QUERY || ' AND ITEMTYPE = ''26'' ';
    END IF;

    V_QUERY:= V_QUERY || ' ORDER BY ITEMNAME ';
    --AND BRANCH_CODE IN (SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID = P_LOG_ID AND ROLE_ID=P_ROLE_ID) 
    
    OPEN P_CURSOR FOR 
        SELECT DISTINCT MUT_CODE, MUT_NAME
        FROM (
            SELECT OSCH_CODE SCH_CODE,OSCH_NAME SCH_NAME,LONGNAME SHORT_NAME,NAME,ISS_NAME MUT_NAME, I.ISS_CODE AS MUT_CODE 
            FROM OTHER_PRODUCT O, PRODUCT_MASTER P,ISS_MASTER I 
            WHERE 1=1 AND O.ISS_CODE LIKE 'MFIS%' 
            AND O.PROD_CLASS_CODE=P.PROD_CODE AND O.ISS_CODE=I.ISS_CODE AND (I.BRANCH_CODE<>'N' OR I.BRANCH_CODE IS NULL) 
            AND (O.FLAG<>'N' OR O.FLAG IS NULL)  
            UNION ALL 
            SELECT SCH_CODE,SCH_NAME,SHORT_NAME,'MF' NAME,MUT_NAME, M.MUT_CODE FROM SCHEME_INFO S,MUT_FUND M 
            WHERE 1=1 --s.sch_code='OP#xxxxx' 
            AND S.MUT_CODE=M.MUT_CODE AND M.MUT_CODE NOT IN ('MF001','MF036','MF002','MF013','MF039','MF029','MF027','MF035','MF020') 
            AND S.SCH_CODE IN (SELECT SCH_CODE FROM MP_SCHEME_MASTER SM WHERE SM.ACTIVE_STATUS='Active' )  
        )ORDER BY MUT_NAME;


END;
/