create or replace PROCEDURE PSM_ASS_M_ASSO_BY_CR (
    P_BRANCH_ID IN VARCHAR2,    
    P_CITY_ID IN VARCHAR2,
    P_MOBILE IN VARCHAR2,
    P_PHONE IN VARCHAR2,
    P_ASSOCIATE_CODE IN VARCHAR2,
    P_PAN_NO IN VARCHAR2,
    P_ASSOCIATE_NAME IN VARCHAR2,
    P_ASSOCIATE_LIST OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN P_ASSOCIATE_LIST FOR
    SELECT AGENT_CODE, AGENT_NAME,EXIST_CODE, ADDRESS1, ADDRESS2, PHONE, MOBILE, EMAIL
    FROM Agent_Master
    WHERE (SOURCEID = P_BRANCH_ID OR P_BRANCH_ID IS NULL)
    AND (UPPER(TRIM(CITY_ID)) = UPPER(TRIM(P_CITY_ID)) OR P_CITY_ID IS NULL)
    AND (UPPER(TRIM(MOBILE)) = UPPER(TRIM(P_MOBILE)) OR P_MOBILE IS NULL)
    AND (UPPER(TRIM(PHONE)) = UPPER(TRIM(P_PHONE)) OR P_PHONE IS NULL)
    AND (UPPER(TRIM(EXIST_CODE)) = UPPER(TRIM(P_ASSOCIATE_CODE)) OR P_ASSOCIATE_CODE IS NULL)
    AND (UPPER(TRIM(PAN)) = UPPER(TRIM(P_PAN_NO)) OR P_PAN_NO IS NULL)
    AND (UPPER(TRIM(AGENT_NAME)) LIKE '%' || UPPER(TRIM(P_ASSOCIATE_NAME)) || '%' OR P_ASSOCIATE_NAME IS NULL)
    ;

END;