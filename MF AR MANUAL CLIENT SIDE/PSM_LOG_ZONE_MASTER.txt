CREATE OR REPLACE PROCEDURE WEALTHMAKER.PSM_LOG_ZONE_MASTER(
P_FOR           IN VARCHAR2,
P_BY            IN VARCHAR2,
P_BY_VALUE      IN VARCHAR2,
P_LOG_ID        IN VARCHAR2,
P_ROLE_ID       IN VARCHAR2,
P_CURSOR         OUT SYS_REFCURSOR

) IS 

BEGIN 

    IF P_FOR = 'MF_AR_MANUAL_RECO' THEN  
        IF P_BY IS NOT NULL THEN
            IF P_BY = 'CHANNEL' THEN
                OPEN P_CURSOR FOR                    
                    SELECT DISTINCT RM.ZONE_NAME AS ZONE_NAME, RM.ZONE_ID AS ZONE_CODE
                    FROM ZONE_MASTER RM
                    JOIN BRANCH_MASTER BM
                    ON RM.ZONE_ID = BM.ZONE_ID
                    WHERE 1=1
                    AND BM.BRANCH_CODE IN (SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID = P_LOG_ID AND ROLE_ID=P_ROLE_ID)
                    AND BM.CATEGORY_ID NOT IN ('1004', '1005', '1006') 
                    AND BM.BRANCH_TAR_CAT = P_BY_VALUE
                    ORDER BY RM.ZONE_NAME;               
            END IF;
        ELSE
            OPEN P_CURSOR FOR 
                    SELECT DISTINCT RM.ZONE_NAME AS ZONE_NAME, RM.ZONE_ID AS ZONE_CODE
                    FROM ZONE_MASTER RM
                    JOIN BRANCH_MASTER BM ON RM.ZONE_ID = BM.ZONE_ID
                    WHERE 1=1
                    AND BM.BRANCH_CODE IN (SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID = P_LOG_ID AND ROLE_ID=P_ROLE_ID)
                    AND BM.CATEGORY_ID NOT IN ('1004', '1005', '1006')
                    ORDER BY RM.ZONE_NAME;
        END IF;
    ELSE
        OPEN P_CURSOR FOR 
            SELECT DISTINCT RM.ZONE_NAME AS ZONE_NAME, RM.ZONE_ID AS ZONE_CODE
            FROM ZONE_MASTER RM
            JOIN BRANCH_MASTER BM ON RM.ZONE_ID = BM.ZONE_ID
            WHERE 1=1
            AND BM.BRANCH_CODE IN (SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID = P_LOG_ID AND ROLE_ID=P_ROLE_ID)
            ORDER BY RM.ZONE_NAME;
    END IF;



    
END PSM_LOG_ZONE_MASTER;
/
