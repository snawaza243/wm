SELECT tmf.TRAN_CODE, tmf.INV_NAME, tmf.UNQ_KEY, tmf.SCH_CODE, si.SCH_NAME, tmf.MUT_CODE, ai.MUT_NAME, tmf.TRAN_TYPE, tmf.APP_NO, tmf.APP_DATE, tmf.CHEQUE_NO, tmf.CHEQUE_DATE,  
WEALTHMAKER.FN_GET_COB_CMV@MF.BAJAJCAPITAL(tmf.FOLIO_NO,tmf.SCH_CODE) amount, 
tmf.BANK_NAME, tmf.FOLIO_NO, tmf.RMCODE, li.RM_NAME, tmf.INVESTOR_TYPE, 
tmf.BRANCH_CODE, ti.BRANCH_NAME, tmf.TR_DATE, tmf.UNITS, tmf.NAV_DATE, 
tmf.REMARK, tmf.FLAG, tmf.BROKER_ID, tmf.REG_TRANTYPE, pi.EXIST_CODE, 
substr(i.ADDRESS1,1,10) as ADDRESS1, tmf.BUSINESS_RMCODE, c.CITY_NAME,  
WEALTHMAKER.GETTRANCODE_ALL(tmf.FOLIO_NO,tmf.SCH_CODE,MAX(tmf.TR_DATE),tmf.TRAN_TYPE,MAX(tmf.TRAN_ID),tmf.UNQ_KEY,'KARVY COB') UNIQUE_TRAN,  
MAX(REG_TRANTYPE) REG_TRANTYPE,max(unq_key) unq_key  
FROM transaction_st@MF.BAJAJCAPITAL tmf
LEFT JOIN scheme_info si ON tmf.SCH_CODE = si.SCH_CODE
LEFT JOIN MUT_FUND ai ON tmf.MUT_CODE = ai.MUT_CODE
LEFT JOIN BRANCH_MASTER ti ON tmf.BRANCH_CODE = ti.BRANCH_CODE
LEFT JOIN EMPLOYEE_MASTER li ON tmf.RMCODE = li.RM_CODE
LEFT JOIN AGENT_MASTER pi ON tmf.source_code = pi.agent_code
LEFT JOIN INVESTOR_MASTER i ON tmf.CLIENT_CODE = i.INV_CODE
LEFT JOIN CITY_MASTER c ON i.CITY_ID = c.CITY_ID 
WHERE 1 = 1 AND tmf.BRANCH_CODE IN (SELECT BRANCH_ID FROM USERDETAILS_JI WHERE LOGIN_ID='112650' AND ROLE_ID='29')  
--AND TO_CHAR(tmf.MUT_CODE) = 'MF050' 
AND (tmf.rec_flag ='N' or tmf.rec_flag is null) 
AND UPPER(tmf.REG_TRANTYPE) NOT LIKE '%SYS%' 
   AND UPPER(tmf.REG_TRANTYPE) NOT LIKE '%SIP%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%S T P IN%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%S T P IN REJ%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%S T P IN REJ REVERSAL%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%STP SWITCH IN%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%OUT%'
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%REINVESTMENT%'
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%STPI%' 
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%STPIR%'
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%REDEMPTION%'
   AND TRIM(UPPER(tmf.REG_TRANTYPE)) NOT LIKE '%PRE-REJECTION%' 
   --AND ( tmf.CHEQUE_NO = '31018241284') 
   --AND UPPER(tmf.INV_NAME) LIKE '%YOGENDER%SINGH%' 
   --AND abs(round(tmf.amount)) = 136125 
   AND LPAD(tmf.mut_code, 2) = 'MF'  AND (tmf.asa <> 'C' OR tmf.asa IS NULL) 
   --AND tmf.tran_type IN ('PURCHASE', 'REINVESTMENT', 'SWITCH IN')  
   GROUP BY TMF.TRAN_CODE, TMF.INV_NAME, TMF.UNQ_KEY, TMF.SCH_CODE, SI.SCH_NAME, TMF.MUT_CODE, AI.MUT_NAME, TMF.TRAN_TYPE, TMF.APP_NO,
  TMF.APP_DATE, TMF.CHEQUE_NO, TMF.CHEQUE_DATE,  WEALTHMAKER.FN_GET_COB_CMV@MF.BAJAJCAPITAL(TMF.FOLIO_NO,TMF.SCH_CODE) , 
  TMF.BANK_NAME, TMF.FOLIO_NO, TMF.RMCODE, LI.RM_NAME, TMF.INVESTOR_TYPE, TMF.BRANCH_CODE, TI.BRANCH_NAME, TMF.TR_DATE, TMF.UNITS,
  TMF.NAV_DATE, TMF.REMARK, TMF.FLAG, TMF.BROKER_ID, TMF.REG_TRANTYPE, PI.EXIST_CODE, SUBSTR(I.ADDRESS1,1,10) , 
  TMF.BUSINESS_RMCODE, C.CITY_NAME ORDER BY tmf.TR_DATE