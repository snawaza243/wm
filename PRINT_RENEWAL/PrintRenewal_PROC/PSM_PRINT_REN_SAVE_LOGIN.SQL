CREATE OR REPLACE PROCEDURE PSM_PRINT_REN_SAVE_LOGIN(
    PX_FORM_PATH IN VARCHAR2,
    PX_FORM_NAME IN VARCHAR2,
    PX_SESSION_ID_FRM_PATH_4_WM IN VARCHAR2,
    PX_LOGE IN VARCHAR2,
    PX_ROLE IN VARCHAR2,
    PX_CURSOR OUT SYS_REFCURSOR
) AS 

    V_MAIN_PATH VARCHAR2(1000);
    V_L_PATH VARCHAR2(1000);

BEGIN
    SAVEPOINT START_TRANSACTION;

    SELECT MAIN INTO V_MAIN_PATH FROM BACKOFFICE_FORMS WHERE MAIN= PX_FORM_NAME;   
    
    IF V_MAIN_PATH IS NOT NULL THEN
        V_L_PATH:=V_MAIN_PATH;
    END IF;

    INSERT INTO APPLICATION_LOG (USER_ID, SESSION_ID, INDATE, INTIME, MODULE, FORM_REPORT)
    VALUES (PX_LOGE, PX_SESSION_ID_FRM_PATH_4_WM, TO_DATE(SYSDATE, 'DD/MM/YYYY'), TO_CHAR(SYSDATE, 'HH24:MI:SS'), 'WEALTHMAKER', SUBSTR(V_L_PATH, -100));
    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK TO START_TRANSACTION;
        RAISE_APPLICATION_ERROR(-20001, 'Error in PSM_PRINT_REN_SAVE_LOGIN: ' || SQLERRM);
END PSM_PRINT_REN_SAVE_LOGIN;
/
