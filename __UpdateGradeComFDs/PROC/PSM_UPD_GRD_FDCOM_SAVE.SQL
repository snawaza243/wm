CREATE OR REPLACE PROCEDURE PSM_UPD_GRD_FDCOM_SAVE(
PX_LOGIN     IN VARCHAR2,
PX_ROLE      IN VARCHAR2,
PX_MONTH     IN VARCHAR2,
PX_YEAR      IN VARCHAR2,
PX_ISS_TAG   IN VARCHAR2,
PX_ISS_CODE  IN VARCHAR2,
PX_ISS_NAME  IN VARCHAR2,
PX_GRADE     IN VARCHAR2,
PX_CURSOR OUT SYS_REFCURSOR   
)AS 

V_ERROR VARCHAR2(1000);
V_QUERY VARCHAR2(4000);

BEGIN

    IF PX_MONTH IS NULL OR PX_YEAR IS NULL THEN
        RAISE_APPLICATION_ERROR(-20001, 'Month and Year are required.');
    END IF;

    delete  from iss_comp_grade where mon_no=PX_MONTH and year_no=PX_YEAR;

    INSERT INTO iss_comp_grade (mon_no, year_no, iss_tag, iss_code, iss_name, grade)
    VALUES (PX_MONTH, PX_YEAR, PX_ISS_TAG, PX_ISS_CODE, PX_ISS_NAME, PX_GRADE);

  OPEN PX_CURSOR FOR
  SELECT 'SUCCESS: DATA INSERTED!' AS MSG FROM DUAL;
EXCEPTION
  WHEN OTHERS THEN
  V_ERROR:= 'ERROR: ' || SUBSTR(SQLERRM,1,100);
  
    OPEN PX_CURSOR FOR
    SELECT V_ERROR AS MSG FROM DUAL;
    
END PSM_UPD_GRD_FDCOM_SAVE;

 